<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Action for selecting meal packages -->
    <record id="action_select_meal_package" model="ir.actions.server">
        <field name="name">Select Meal Package</field>
        <field name="model_id" ref="model_event_booking"/>
        <field name="binding_model_id" ref="model_menu_meal"/>
        <field name="state">code</field>
        <field name="code">
            action = model.browse(env.context.get('active_id')).action_select_meal_from_kanban()
        </field>
    </record>

    <!-- Action for removing meal packages -->
    <record id="action_remove_meal_package" model="ir.actions.server">
        <field name="name">Remove Meal Package</field>
        <field name="model_id" ref="model_event_booking"/>
        <field name="binding_model_id" ref="model_menu_meal"/>
        <field name="state">code</field>
        <field name="code">
            action = model.browse(env.context.get('active_id')).action_remove_meal_from_kanban()
        </field>
    </record>

    <!-- Action for removing dishes -->
    <record id="action_remove_dish" model="ir.actions.server">
        <field name="name">Remove Dish</field>
        <field name="model_id" ref="model_event_booking"/>
        <field name="binding_model_id" ref="model_menu_dishes"/>
        <field name="state">code</field>
        <field name="code">
            action = model.browse(env.context.get('active_id')).action_remove_dish()
        </field>
    </record>
    <!-- Enhanced Form View with JavaScript Integration -->
    <record id="view_event_booking_enhanced_form" model="ir.ui.view">
        <field name="name">event.booking.enhanced.form</field>
        <field name="model">event.booking</field>
        <field name="arch" type="xml">
            <form string="Event Booking" class="event-booking-form">
                <header class="status-bar">
                    <button name="action_confirm" type="object" string="Confirm Booking"
                            class="btn btn-confirm"
                            invisible="status != 'draft'"/>

                    <button name="action_cancel" type="object" string="Cancel Booking"
                            class="btn btn-cancel"
                            confirm="Are you sure you want to cancel this booking?"
                            invisible="status != 'confirmed'"/>

                    <button name="%(action_report_booking_full)d" type="action" string="üñ®Ô∏è Print Report"
                            class="btn btn-primary"/>

                    <field name="status" widget="statusbar"/>
                </header>

                <sheet>
                    <div class="booking-header">
                        üéâBooking Form üéâ
                    </div>

                    <div class="booking-section">
                        <group>
                            <group>
                                <field name="name" class="booking-field" placeholder="Enter customer name"/>
                                <field name="phone" class="booking-field" placeholder="Enter phone number"/>
                                <field name="event_type_id" class="booking-field"/>
                                <field name="event_category_id" class="booking-field"
                                       domain="[('event_type_id', '=', event_type_id)]"/>
                            </group>
                            <group>
                                <field name="hall_id" class="booking-field"/>
                                <field name="booking_date" class="booking-field"/>
                                <field name="start_time" class="booking-field"/>
                                <field name="end_time" class="booking-field"/>
                                <field name="total_person" class="booking-field"/>
                            </group>
                        </group>
                    </div>

                    <notebook>
                        <page string="üçΩÔ∏è Menu Selection">
                            <div class="meat-type-buttons" style="margin-bottom: 20px;">
                                <h4 style="color: #875A7B; margin-bottom: 15px;">Select Meat Preference</h4>
                                <button name="action_set_chicken" type="object" string="üêî Chicken"
                                        class="btn"/>
                                <button name="action_set_mutton" type="object" string="üêë Mutton"
                                        class="btn"/>
                                <button name="action_set_beef" type="object" string="üêÑ Beef"
                                        class="btn"/>
                                <field name="meat_type_filter" invisible="1"/>
                            </div>

                            <!--                            <div class="row">-->
                            <!--                                <div class="col-md-6">-->
                            <!--                                    <button name="action_open_meal_packages" type="object"-->
                            <!--                                            string="üì¶ Select Meal Package" class="btn btn-success mb-3"/>-->
                            <!--                                </div>-->
                            <!--                            </div>-->

                            <!-- Available Meal Packages -->
                            <div invisible="not meat_type_filter" style="margin-top: 20px;">
                                <h4 style="color: #875A7B; margin-bottom: 15px;">üìã Available Meal Packages</h4>
                                <field name="available_meal_packages" mode="kanban" nolabel="1">
                                    <kanban>
                                        <field name="name"/>
                                        <field name="meat_type"/>
                                        <field name="total_meal_price"/>
                                        <field name="meat_dishes"/>
                                        <field name="rice_dish_ids"/>
                                        <field name="dessert_ids"/>
                                        <field name="salad_ids"/>
                                        <field name="drink_ids"/>
                                        <field name="bread_ids"/>
                                        <templates>
                                            <t t-name="card">
                                                <div class="meal-package-card"
                                                     style="width: 300px; margin: 10px; padding: 15px;">
                                                    <div style="text-align: center; margin-bottom: 10px;">
                                                        <h5 style="color: #875A7B; font-weight: bold;">
                                                            <field name="name"/>
                                                        </h5>
                                                        <span class="badge badge-secondary" style="font-size: 12px;">
                                                            <field name="meat_type"/>
                                                        </span>
                                                    </div>

                                                    <div class="price-display">
                                                        Rs.
                                                        <field name="total_meal_price"/>
                                                        per person
                                                    </div>

                                                    <div style="font-size: 13px; line-height: 1.5;">
                                                        <t t-if="record.meat_dishes.raw_value">
                                                            <div>üçñ
                                                                <field name="meat_dishes"/>
                                                            </div>
                                                        </t>
                                                        <t t-if="record.rice_dish_ids.raw_value">
                                                            <div>üçö
                                                                <field name="rice_dish_ids"/>
                                                            </div>
                                                        </t>
                                                        <t t-if="record.dessert_ids.raw_value">
                                                            <div>üç∞
                                                                <field name="dessert_ids"/>
                                                            </div>
                                                        </t>
                                                        <t t-if="record.salad_ids.raw_value">
                                                            <div>ü•ó
                                                                <field name="salad_ids"/>
                                                            </div>
                                                        </t>
                                                        <t t-if="record.drink_ids.raw_value">
                                                            <div>ü•§
                                                                <field name="drink_ids"/>
                                                            </div>
                                                        </t>
                                                        <t t-if="record.bread_ids.raw_value">
                                                            <div>üçû
                                                                <field name="bread_ids"/>
                                                            </div>
                                                        </t>
                                                    </div>

                                                    <!--                                                    <div style="margin-top: 15px; display: flex; gap: 8px;">-->
                                                    <!--                                                        <button type="action"-->
                                                    <!--                                                                name="%(event_management.action_select_meal_package)d"-->
                                                    <!--                                                                string="‚úì Select" context="{'default_meal_id': id}"-->
                                                    <!--                                                                class="btn btn-sm btn-success" style="flex: 1;"/>-->
                                                    <!--                                                        <button type="action"-->
                                                    <!--                                                                name="%(event_management.action_remove_meal_package)d"-->
                                                    <!--                                                                string="‚úó Remove" context="{'default_meal_id': id}"-->
                                                    <!--                                                                class="btn btn-sm btn-danger" style="flex: 1;"/>-->
                                                    <!--                                                    </div>-->
                                                </div>
                                            </t>
                                        </templates>
                                    </kanban>
                                </field>
                            </div>

                            <!-- Selected Meal Packages -->
                            <div style="margin-top: 20px;">
                                <h4 style="color: #875A7B; margin-bottom: 15px;">üì¶ Selected Meal Packages</h4>
                                <field name="selected_meal_packages" mode="kanban" nolabel="1">
                                    <kanban>
                                        <field name="name"/>
                                        <field name="meat_type"/>
                                        <field name="total_meal_price"/>
                                        <field name="meat_dishes"/>
                                        <field name="rice_dish_ids"/>
                                        <field name="dessert_ids"/>
                                        <field name="salad_ids"/>
                                        <field name="drink_ids"/>
                                        <field name="bread_ids"/>
                                        <templates>
                                            <t t-name="card">
                                                <div class="meal-package-card"
                                                     style="width: 300px; margin: 10px; padding: 15px;">
                                                    <div style="text-align: center; margin-bottom: 10px;">
                                                        <h5 style="color: #875A7B; font-weight: bold;">
                                                            <field name="name"/>
                                                        </h5>
                                                        <span class="badge badge-secondary" style="font-size: 12px;">
                                                            <field name="meat_type"/>
                                                        </span>
                                                    </div>

                                                    <div class="price-display">
                                                        Rs.
                                                        <field name="total_meal_price"/>
                                                        per person
                                                    </div>

                                                    <div style="font-size: 13px; line-height: 1.5;">
                                                        <t t-if="record.meat_dishes.raw_value">
                                                            <div>üçñ
                                                                <field name="meat_dishes"/>
                                                            </div>
                                                        </t>
                                                        <t t-if="record.rice_dish_ids.raw_value">
                                                            <div>üçö
                                                                <field name="rice_dish_ids"/>
                                                            </div>
                                                        </t>
                                                        <t t-if="record.dessert_ids.raw_value">
                                                            <div>üç∞
                                                                <field name="dessert_ids"/>
                                                            </div>
                                                        </t>
                                                        <t t-if="record.salad_ids.raw_value">
                                                            <div>ü•ó
                                                                <field name="salad_ids"/>
                                                            </div>
                                                        </t>
                                                        <t t-if="record.drink_ids.raw_value">
                                                            <div>ü•§
                                                                <field name="drink_ids"/>
                                                            </div>
                                                        </t>
                                                        <t t-if="record.bread_ids.raw_value">
                                                            <div>üçû
                                                                <field name="bread_ids"/>
                                                            </div>
                                                        </t>
                                                    </div>

                                                    <!--                                                    <div style="margin-top: 15px;">-->
                                                    <!--                                                        <button type="action"-->
                                                    <!--                                                                name="%(event_management.action_remove_meal_package)d"-->
                                                    <!--                                                                string="‚úó Remove Package"-->
                                                    <!--                                                                context="{'default_meal_id': id}"-->
                                                    <!--                                                                class="btn btn-sm btn-danger" style="width: 100%;"/>-->
                                                    <!--                                                    </div>-->
                                                </div>
                                            </t>
                                        </templates>
                                    </kanban>
                                </field>
                            </div>

                            <!-- Selected Dishes -->
                            <div style="margin-top: 20px;">
                                <h4 style="color: #875A7B; margin-bottom: 15px;">üçΩÔ∏è Selected Dishes</h4>
                                <field name="selected_dishes" mode="kanban" nolabel="1">
                                    <kanban>
                                        <field name="name"/>
                                        <field name="meal_type"/>
                                        <field name="image"/>
                                        <!--                                        <field name="price"/>-->
                                        <templates>
                                            <t t-name="card">
                                                <div class="dish-card"
                                                     style="width: 200px; margin: 10px; position: relative;">
                                                    <button type="action" name="%(event_management.action_remove_dish)d"
                                                            string="√ó" context="{'default_dish_id': id}"
                                                            class="dish-remove-btn" title="Remove Dish"/>
                                                    <div class="o_kanban_image">
                                                        <field name="image" widget="image"
                                                               options="{'size': [150, 120]}"
                                                               style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px 8px 0 0;"/>
                                                    </div>
                                                    <div style="padding: 12px; text-align: center;">
                                                        <strong style="color: #049f5f; font-size: 14px;">
                                                            <field name="name"/>
                                                        </strong>
                                                        <br/>
                                                        <span class="badge badge-info" style="margin-top: 5px;">
                                                            <field name="meal_type"/>
                                                        </span>
                                                        <!--                                                        <div style="margin-top: 8px; color: #875A7B; font-weight: bold;">-->
                                                        <!--                                                            Rs.-->
                                                        <!--&lt;!&ndash;                                                            <field name="price"/>&ndash;&gt;-->
                                                        <!--                                                        </div>-->
                                                    </div>
                                                </div>
                                            </t>
                                        </templates>
                                    </kanban>
                                </field>
                            </div>

                            <!-- Price Summary -->
                            <div class="booking-section" style="margin-top: 20px;">
                                <group>
                                    <group>
                                        <field name="dishes_per_person" readonly="1" string="üí∞ Per Person Cost"/>
                                        <field name="total_person" readonly="1" string="üë• Total Persons"/>
                                    </group>
                                    <group>
                                        <field name="total_meal_price" readonly="1" string="üì¶ Meal Package Cost"/>
                                        <field name="amenities_total" readonly="1" string="üé™ Amenities Cost"/>
                                        <field name="total_dishes_cost" readonly="1" string="üßæ Total Food Cost"/>
                                        <field name="grand_total" readonly="1" string="üí∞ Grand Total (Rs.)"
                                               style="font-weight: bold; color: #875A7B;"/>
                                    </group>
                                </group>
                            </div>
                        </page>

                        <page string="üé™ Amenities">
                            <div style="margin-top: 20px;">
                                <h4 style="color: #875A7B; margin-bottom: 15px;">üìã Available Amenities</h4>
                                <field name="amenities" mode="kanban" nolabel="1">
                                    <kanban>
                                        <field name="id"/>
                                        <field name="name"/>
                                        <field name="type"/>
                                        <field name="price"/>
                                        <field name="image"/>
                                        <templates>
                                            <t t-name="kanban-box">
                                                <div class="oe_kanban_card"
                                                     style="width: 300px; margin: 5px; cursor: pointer; border: 3px solid #049f5f; background-color: #e8f5e8; position: relative; border-radius: 8px;">

                                                    <div class="o_kanban_image">
                                                        <img t-att-src="kanban_image('event.amenity', 'image', record.id.raw_value)" alt="Amenity"/>
                                                    </div>
                                                    <div class="oe_kanban_details o_kanban_record_headings"
                                                         style="padding: 15px;">
                                                        <strong class="o_kanban_record_title">
                                                            <field name="name"/>
                                                        </strong>
                                                        <div class="o_kanban_record_subtitle">
                                                            <field name="type"/>
                                                        </div>
                                                        <div class="oe_kanban_bottom_right">
                                                            <strong>Rs.
                                                                <field name="price"/>
                                                            </strong>
                                                        </div>
                                                    </div>
                                                </div>
                                            </t>
                                        </templates>
                                    </kanban>
                                </field>
                            </div>

                            <div class="price-display" style="margin-top: 15px;">
                                Total Amenities Cost: Rs.
                                <field name="amenities_total" readonly="1"/>
                            </div>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Enhanced List View -->
    <record id="view_event_booking_enhanced_list" model="ir.ui.view">
        <field name="name">event.booking.enhanced.list</field>
        <field name="model">event.booking</field>
        <field name="arch" type="xml">
            <list decoration-success="status == 'confirmed'"
                  decoration-muted="status == 'cancelled'"
                  decoration-info="status == 'draft'">
                <field name="name"/>
                <field name="phone"/>
                <field name="event_type_id"/>
                <field name="hall_id"/>
                <field name="booking_date"/>
                <field name="total_person"/>
                <field name="total_dishes_cost" string="Food Cost"/>
                <field name="amenities_total" string="Amenities"/>
                <field name="status" widget="badge"
                       decoration-success="status == 'confirmed'"
                       decoration-warning="status == 'draft'"
                       decoration-danger="status == 'cancelled'"/>
            </list>
        </field>
    </record>

    <!-- Update Action to use enhanced views -->
    <record id="action_event_booking_enhanced" model="ir.actions.act_window">
        <field name="name">Event Bookings</field>
        <field name="res_model">event.booking</field>
        <field name="view_mode">list,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
                                      (0, 0, {'view_mode': 'list', 'view_id': ref('view_event_booking_enhanced_list')}),
                                      (0, 0, {'view_mode': 'form', 'view_id': ref('view_event_booking_enhanced_form')})]"/>
    </record>

    <!-- Menu Items -->
    <menuitem id="menu_enhanced_bookings"
              name="Enhanced Bookings"
              action="action_event_booking_enhanced"
              parent="menu_event_management_root"
              sequence="5"/>
</odoo>